--Cambia la sesion al pluggable DB. Este script debe de ser corrido con user que tenga SYSDBA grants
ALTER SESSION SET container = orclpdb;

--Esto elimina le usuario y todos sus objetos. Permite recrear todos los objetos facilmente.
DECLARE
    v_count     INTEGER := 0;
    v_statement VARCHAR2(500);
BEGIN
    SELECT
        COUNT(1)
    INTO v_count
    FROM
        dba_users
    WHERE
        username = upper('NEGOCIO');

    IF v_count != 0 THEN
        EXECUTE IMMEDIATE ( 'DROP USER NEGOCIO CASCADE' );
    END IF;
    v_count := 0;
END;

CREATE USER NEGOCIO IDENTIFIED BY NEGOCIO;
GRANT CREATE SESSION, CREATE VIEW, ALTER SESSION, CREATE SEQUENCE TO NEGOCIO;
GRANT CREATE SYNONYM, CREATE DATABASE LINK, RESOURCE , UNLIMITED TABLESPACE TO NEGOCIO;
--SELECT USERNAME, DEFAULT_TABLESPACE, TEMPORARY_TABLESPACE, CREATED FROM DBA_USERS WHERE USERNAME ='NEGOCIO';

--Se selecciona el nuevo usuario como schema default
ALTER SESSION SET CURRENT_SCHEMA=NEGOCIO;

--Creacion de tablas

CREATE TABLE ROLES(
ID_ROLE NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
NOMBRE VARCHAR2(30),
PRIMARY KEY(ID_ROLE)
);

CREATE TABLE ESTADOS(
ID_ESTADO NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
NOMBRE VARCHAR2(30),
PRIMARY KEY(ID_ESTADO)
);

CREATE TABLE PERSONAS(
ID_PERSONA NUMBER,
NOMBRE VARCHAR2(30) NOT NULL,
PRIMER_APELLIDO VARCHAR2(30) NOT NULL,
SEGUNDO_APELLIDO VARCHAR2(30),
DIRECCION VARCHAR2(100),
TELEFONO VARCHAR2(15) NOT NULL,
PASSWORD VARCHAR2(20),
ROLE_ID NUMBER,
ESTADO_ID NUMBER,
CONSTRAINT PK_PERSONA PRIMARY KEY(ID_PERSONA),
CONSTRAINT PK_PERSONAS_CATEGORIAS FOREIGN KEY(ROLE_ID) REFERENCES ROLES,
CONSTRAINT PK_PERSONAS_ESTADOS FOREIGN KEY(ESTADO_ID) REFERENCES ESTADOS);

CREATE TABLE CATEGORIAS(
ID_CATEGORIA NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
NOMBRE VARCHAR2(50),
CATEGORIA_MADRE_ID NUMBER,
CONSTRAINT PK_CATEGORIAS PRIMARY KEY(ID_CATEGORIA),
CONSTRAINT PK_CATEGORIAS_CATEGORIAS FOREIGN KEY(CATEGORIA_MADRE_ID) REFERENCES CATEGORIAS);


CREATE TABLE MARCAS(
MARCA_ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
NOMBRE VARCHAR2(50),
CONSTRAINT PK_MARCAS PRIMARY KEY(MARCA_ID));

CREATE TABLE PRODUCTOS(
ID_PRODUCTO NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
CATEGORIA_ID NUMBER,
MARCA_ID NUMBER,
NOMBRE VARCHAR2(30),
DETALLE VARCHAR2(50),
PRECIO NUMBER(8, 2) NOT NULL,
TAMANO VARCHAR2(20),
CANTIDAD NUMBER(5),
CONSTRAINT PK_PRODUCTOS PRIMARY KEY(ID_PRODUCTO),
CONSTRAINT PK_PRODUCTOS_CATEGORIAS FOREIGN KEY(CATEGORIA_ID) REFERENCES CATEGORIAS,
CONSTRAINT PK_PRODUCTOS_MARCAS FOREIGN KEY(MARCA_ID) REFERENCES MARCAS);



CREATE TABLE FACTURAS (
ID_FACTURA NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
VENDEDOR_ID NUMBER,
CLIENTE_ID NUMBER,
FECHA TIMESTAMP DEFAULT SYSDATE,
TOTAL NUMBER(8, 2),
CONSTRAINT PK_FACTURA PRIMARY KEY(ID_FACTURA),
CONSTRAINT PK_FACTURA_PERSONAS FOREIGN KEY(VENDEDOR_ID) REFERENCES PERSONAS,
CONSTRAINT PK_FACTURA_CLIENTES FOREIGN KEY(CLIENTE_ID) REFERENCES PERSONAS);


CREATE TABLE DETALLE (
ID_FACTURA NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
ID_DETALLE NUMBER NOT NULL, 
PRODUCTO_ID NUMBER, 
CANTIDAD NUMBER(2), 
PRECIO NUMBER(8, 2),
IVA NUMBER(3, 2),
SUBTOTAL NUMBER(8, 2), 
PRIMARY KEY(ID_FACTURA,ID_DETALLE), 
constraint pk_detalle_facturas FOREIGN KEY(ID_FACTURA)REFERENCES FACTURAS,
constraint pk_detalle_productos FOREIGN KEY(PRODUCTO_ID)REFERENCES PRODUCTOS);


INSERT INTO ROLES  VALUES ('Cliente');
INSERT INTO ROLES  VALUES ('Proveedor');
INSERT INTO ROLES  VALUES ('Administracion');


INSERT INTO ESTADOS  VALUES ('Activo');
INSERT INTO ESTADOS  VALUES ('Inactivo');

INSERT INTO  PERSONAS  VALUES ('Inactivo');


INSERT INTO PERSONAS  (NOMBRE,PRIMER_APELLIDO,SEGUNDO_APELLIDO,DIRECCION,EMAIL) VALUES ('Shreya','Mcdonald','Strickland','Whitefield View','Shreya@gmail.com','86543422','Canbiame_123',0,0);
INSERT INTO PERSONAS  (NOMBRE,PRIMER_APELLIDO,SEGUNDO_APELLIDO,DIRECCION,EMAIL) VALUES ('Xaver','Berry','Mejia','Whitefield View','Xaver@gmail.com','86423531','Cambiame_123',0,0);
INSERT INTO PERSONAS  (NOMBRE,PRIMER_APELLIDO,SEGUNDO_APELLIDO,DIRECCION,EMAIL) VALUES ('Eduard','Fernandez','Palmer','Port Riddell','Eduard@gmail.com','832341','Cambiame_123',0,0);
INSERT INTO PERSONAS  (NOMBRE,PRIMER_APELLIDO,SEGUNDO_APELLIDO,DIRECCION,EMAIL) VALUES ('Dipti','Thompson','Alexander','Fell Heath','Dipti@gmail.com','83153431','Cambiame_123',0,0);
INSERT INTO PERSONAS  (NOMBRE,PRIMER_APELLIDO,SEGUNDO_APELLIDO,DIRECCION,EMAIL) VALUES ('Nuria','Davidson','Mann','Thirlwall Drive','Nuria@gmail.com','83234133','Cambiame_123',0,0);
INSERT INTO PERSONAS  (NOMBRE,PRIMER_APELLIDO,SEGUNDO_APELLIDO,DIRECCION,EMAIL) VALUES ('Ketut','Ramirez','Wise','Southburn Terrace','Ketut@gmail.com','64234131','Cambiame_123',0,);
INSERT INTO PERSONAS  (NOMBRE,PRIMER_APELLIDO,SEGUNDO_APELLIDO,DIRECCION,EMAIL) VALUES ('Wolfgang','Stevenson','Thornton','Oakley Paddock','Wolfgang@gmail.com','83134133','Cambiame_123',0,0);
INSERT INTO PERSONAS  (NOMBRE,PRIMER_APELLIDO,SEGUNDO_APELLIDO,DIRECCION,EMAIL) VALUES ('Subrahmanya','Burns','Khan','Williamson Bank','Subrahmanya@gmail.com','64354212','Cambiame_123',0,0);
INSERT INTO PERSONAS  (NOMBRE,PRIMER_APELLIDO,SEGUNDO_APELLIDO,DIRECCION,EMAIL) VALUES ('Ptah','Robinson','Kaye','Holden Elms','Ptah@gmail.com','86434231','Cambiame_123',0,0);
INSERT INTO PERSONAS  (NOMBRE,PRIMER_APELLIDO,SEGUNDO_APELLIDO,DIRECCION,EMAIL) VALUES ('Barbara','Kirby','Rossi','Crispin Coppice','Barbara@gmail.com','75331243','Cambiame_123',0,0);

INSERT INTO CATEGORIAS  (NOMBRE,CATEGORIA_MADRE_ID) VALUES ('Ropa','');  --0
INSERT INTO CATEGORIAS  (NOMBRE,CATEGORIA_MADRE_ID) VALUES ('Perfumes','');--1
INSERT INTO CATEGORIAS  (NOMBRE,CATEGORIA_MADRE_ID) VALUES ('Licores',''); --2
INSERT INTO CATEGORIAS  (NOMBRE,CATEGORIA_MADRE_ID) VALUES ('Camisas',0);
INSERT INTO CATEGORIAS  (NOMBRE,CATEGORIA_MADRE_ID) VALUES ('Pantalonetas',0);
INSERT INTO CATEGORIAS  (NOMBRE,CATEGORIA_MADRE_ID) VALUES ('Zapatos',0);
INSERT INTO CATEGORIAS  (NOMBRE,CATEGORIA_MADRE_ID) VALUES ('Camisetas',0);
INSERT INTO CATEGORIAS  (NOMBRE,CATEGORIA_MADRE_ID) VALUES ('Vino',0);
INSERT INTO CATEGORIAS  (NOMBRE,CATEGORIA_MADRE_ID) VALUES ('Pantalonetas',0);
INSERT INTO CATEGORIAS  (NOMBRE,CATEGORIA_MADRE_ID) VALUES ('Zapatos',0);
INSERT INTO CATEGORIAS  (NOMBRE,CATEGORIA_MADRE_ID) VALUES ('Camisetas',0);
INSERT INTO CATEGORIAS  (NOMBRE,CATEGORIA_MADRE_ID) VALUES ('Perfumes Hombre',1);
INSERT INTO CATEGORIAS  (NOMBRE,CATEGORIA_MADRE_ID) VALUES ('Perfumes Mujer',1);
INSERT INTO CATEGORIAS  (NOMBRE,CATEGORIA_MADRE_ID) VALUES ('Whisky',2);
INSERT INTO CATEGORIAS  (NOMBRE,CATEGORIA_MADRE_ID) VALUES ('Tipo licor 2',2);
INSERT INTO CATEGORIAS  (NOMBRE,CATEGORIA_MADRE_ID) VALUES ('Tipo licor 3',2);

INSERT INTO MARCAS (NOMBRE) VALUES ('Nike');
INSERT INTO MARCAS (NOMBRE) VALUES ('Adidas');
INSERT INTO MARCAS (NOMBRE) VALUES ('Puma');
INSERT INTO MARCAS (NOMBRE) VALUES ('Bocceli');
INSERT INTO MARCAS (NOMBRE) VALUES ('CHANEL');
INSERT INTO MARCAS (NOMBRE) VALUES ('HERMES Paris');
INSERT INTO MARCAS (NOMBRE) VALUES ('ck');
INSERT INTO MARCAS (NOMBRE) VALUES ('Hugo BOSS');
INSERT INTO MARCAS (NOMBRE) VALUES ('Jack Daniels');
INSERT INTO MARCAS (NOMBRE) VALUES ('Johhny Walker');

